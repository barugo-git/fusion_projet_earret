{% extends 'base.html.twig' %}

{% block stylesheets %}
	<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet"/>


{% endblock %}
{% form_theme form _self %}

{#{% form_theme form 'form_theme/_form_collection_conseil_defendeur.html.twig' %}#}
{% form_theme form 'form_theme/_form_collection_dossier.html.twig' %}
{% block body %}
	<div class="row">
		{{ form_start(form) }}
		<div class="col-lg-12">
			<div class="card">
				<div class="card-header">
					{% if app.request.attributes.get('_route') == 'greffier_demande_edit_recours' %}
						{% include 'partials/_intitule_dossier.html.twig' %}
					{% else %}
						<h4 class="card-title mb-0">Enregistrement d'un recours - Informations de la requete</h4>
					{% endif %}
				</div>
				<!-- end card header -->
				<div class="card-body">
					<div>
						<div class="container">
							<div class="row">
								<div class="col-md-6">
									{{ form_row(form.dateEnregistrement) }}
								</div>
								<div class="col-md-6">
									{{ form_row(form.objet) }}
								</div>

								<div class="col-md-6">
									{{ form_row(form.referenceEnregistrement) }}

								</div>
								<div class="col-md-6">
									{{ form_row(form.typeDossier) }}
								</div>
								<div class="col-md-12">
									{{ form_row(form.arreteAttaquee) }}
								</div>

								<div class="col-md-12 mb-3">
									{{ form_row(form.structure) }}

								</div>
								{#                                <div class="col-md-12">#}
								{#                                    {{ form_row(form.intituleObjet) }}#}

								{#                                </div>#}
									{% if app.request.attributes.get('_route') == 'greffier_demande_edit_recours' %}
										<div class="col-lg-12"> <h4 class="card-title mb-0">Pieces de la requête</h4>
										<table class="table">
											<thead>
												<tr>
													<th>
														Nom de la piece</th>
													<th></th>
													<th></th>
												</tr>
											</thead>
											<tbody>
												{% for piece in dossier.pieces %}
													<tr>
														<td>
															{{ piece.name }}</td>
														<td><img src="{{ asset(piece.path) }}" alt="" width="55"></td>
														<td>
															<a href="{{ piece.path }}" target="_blank">
																<i class="ri-eye-fill align-bottom me-2 text-muted"></i>
																Voir la piece
															</a>
														</td>
													</tr>
												{% endfor %}
											</tbody>
										</table>
									</div>
								{% else %}
									{{ form_row(form.pieces) }}
								{% endif %}

							</div>

						</div>
					</div>
				</div>
			</div>
		</div>
		<div>
			{% if app.request.attributes.get('_route') == 'greffier_demande_edit_recours' %}{% endif %}
		</div>
		{% if app.request.attributes.get('_route') == 'greffier_demande_edit_recours' %}
			<button type="submit" class="btn btn-success btn-label right">
				<i class="ri-arrow-right-line label-icon align-middle fs-16 ms-2"></i>Modifier
															                    le recours
			</button>
		{% else %}
			<button type="submit" class="btn btn-success btn-label right">
				<i class="ri-arrow-right-line label-icon align-middle fs-16 ms-2"></i>Enregistrer
															                       le recours
			</button>
		{% endif %}

		{{ form_end(form) }}

		{#            {{ include('dossier/_form.html.twig') }}#}

	</div>


	{#    <a href="{{ path('app_dossier_index') }}">back to list</a>#}
{% endblock %}
{% block javascripts %}
	<script src="{{ asset('js/jquery-3.6.0.min.js') }}"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script>
		// var $typerequerent = $('#dossier_defendeur_defendeur_type')
// $typerequerent.change(function () {
//     console.log($typerequerent.val())
//     if ($typerequerent.val() == "moral") {
//         $('.morale').show()
//         $('.physique').hide()
//
//     } else if ($typerequerent.val() == "physique") {
//         $('.morale').hide()
//         $('.physique').show()
//     }
//
// })
//
// class LinkedSelect {
//
//     /**
//      * @param {HTMLSelectElement} $select
//      */
//     constructor($select) {
//         this.$select = $select
//         this.$target = document.querySelector(this.$select.dataset.target)
//         this.$placeholder = this.$target.firstElementChild
//         //  this.onChange = debounce(this.onChange.bind(this), 500)
//         this.onChange = this.onChange.bind(this)
//         this.$loader = null
//         this.cache = {}
//         this.$select.addEventListener('change', this.onChange)
//     }
//
//     /**
//      * Se déclenche au changement de valeur d'un select
//      * @param {Event} e
//      */
//     onChange(e) {
//         if (e.target.value === '0') {
//
//             return
//         }
//
//         this.loadOptions(e.target.value, (options) => {
//             this.$target.innerHTML = options
//             this.$target.insertBefore(this.$placeholder, this.$target.firstChild)
//             this.$target.selectedIndex = 0
//             this.$target.style.display = null
//
//         })
//     }
//
//     /**
//      * Charge les options à partir du serveur (ou du cache)
//      * @param {string} id
//      * @param callback
//      */
//     loadOptions(id, callback) {
//         if (this.cache[id]) {
//             callback(this.cache[id])
//             return
//         }
//         this.showLoader()
//         let request = new XMLHttpRequest()
//         request.open('GET', this.$select.dataset.source.replace('id', id), true)
//         request.onload = () => {
//             if (request.status >= 200 && request.status < 400) {
//                 let data = JSON.parse(request.responseText)
//                 let options = data.reduce(function (acc, option) {
//                     return acc + '<option value="' + option.value + '">' + option.label + '</option>'
//                 }, '')
//                 this.cache[id] = options
//                 this.hideLoader()
//                 callback(options)
//             } else {
//                 alert('Impossible de charger la liste')
//             }
//         }
//         request.onerror = function () {
//             alert('Impossible de charger la liste')
//         }
//         request.send()
//     }
//
//     showLoader() {
//         this.$loader = document.createTextNode('Chargement...')
//         this.$target.parentNode.appendChild(this.$loader)
//     }
//
//     hideLoader() {
//         if (this.$loader !== null) {
//             this.$loader.parentNode.removeChild(this.$loader)
//             this.$loader = null
//         }
//     }
//
// %}
//
// let $selects = document.querySelectorAll('.linked-select')
// $selects.forEach(function ($select) {
//     new LinkedSelect($select)
//
// })

$('#add-image').click(function () { // Je récupère le numéo des futurs champs que je vais créer
const index = + $('#widgets-counter').val();

console.log(index);

// Je récupère le prototype des entrées (remplace /__name__/(g veut dire qu'on peut le faire plusieurs fois) par index)
const tmpl = $('#dossier_pieces').data('prototype').replace(/__name__/g, index);

// J'injecte ce code au sein de la div
$('#dossier_pieces').append(tmpl);

$('#widgets-counter').val(index + 1);

// Je gère le bouton supprimer
handleDeleteButtons();
})

function handleDeleteButtons() {
$('button[data-action="delete"]').click(function () {
const target = this.dataset.target;

$(target).remove();
})
}

function updateCounter() {
const count = + $('#dossier_pieces div.form-group').length;

$('#widgets-counter').val(count);
}

updateCounter();

handleDeleteButtons();
	</script>
{% endblock %}
